{template '_header'}

<div class="page-heading">

            <span class="pull-right">

                <a class="btn btn-primary btn-sm" href="{php echo webUrl('goods/loupan_post');}">添加项目</a>

                <a class="btn btn-default btn-sm" href="{php echo webUrl('goods/loupan');}">返回列表</a>

            </span>
    {if $id!=''}<h2>编辑项目 <small>修改【<span class="text-info">{$item['title']}</span>】</small></h2>{else}<h2>添加项目<small></small></h2>{/if}
</div>

<form class="form-horizontal form form-validate" action="" method="post" enctype="multipart/form-data" >
    <input type="hidden" name="id" value="{$item[id]}">
    <div class="tabs-container tab-goods" >
        <div class="" tabs-left="" >
            <ul class="nav nav-tabs" id="myTab">
                <li class="active" ><a href="#tab_jiben">基本信息</a></li>
                <li><a href="#tab_jjr">经纪人设置</a></li>
                <li><a href="#tab_llb">楼盘详情列表样式</a></li>
                <li><a href="#tab_share">分享设置</a></li>
            </ul>
            <div class="tab-content">

                <div class="tab-pane  active" id="tab_jiben">
                    <div class="panel-body">

                        <div class="form-group">
                            <label class="col-xs-12 col-sm-2 col-md-2 control-label">排序</label>
                            <div class="col-sm-5">
                                <input type="text" name="displayorder" class="form-control" value="{$item['displayorder']}" />
                                <span class="help-block">产品优先级，越大则越靠前</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-xs-12 col-sm-2 col-md-2 control-label">名称</label>
                            <div class="col-sm-5">
                                <input type="text" name="title" class="form-control" value="{$item['title']}" />
                                <span class="help-block">产品名称</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-xs-12 col-sm-2 col-md-2 control-label">封面</label>
                            <div class="col-sm-5">
                                {php echo tpl_form_field_image('thumb', $item['thumb']);}
                                <span class="help-block">图片大小480px X 240px</span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-xs-12 col-sm-2 col-md-2 control-label">楼盘优惠</label>
                            <div class="col-sm-5">
                                <input type="text" name="l_youhui" class="form-control" value="{$item['l_youhui']}" />
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-xs-12 col-sm-2 col-md-2 control-label">楼盘标签</label>
                            <div class="col-sm-5">
                                <input type="text" name="l_biaoqian" class="form-control" value="{$item['l_biaoqian']}" />
                            </div>
                            <span class="help-block">不同标签空格隔开</span>
                        </div>

                        <div class="form-group">
                            <label class="col-xs-12 col-sm-2 col-md-2 control-label">房价</label>
                            <div class="col-sm-7">
                                    <div class="input-group">
                                        <span class="input-group-addon">价格类型：</span>
                                        <input type="text" name="price_type" class="form-control" value="{$item['price_type']}" placeholder="">
                                        <span class="input-group-addon">价格：</span>
                                            <input type="text" name="price" class="form-control" value="{$item['price']}" />
                                            <span class="input-group-addon">元/m²</span>
                                    </div>

                                <span class="help-block">请输入房价</span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-xs-12 col-sm-2 col-md-2 control-label">预计佣金</label>
                            <div class="col-sm-5">
                                <div class="input-group">
                                    <input type="text" name="commis" class="form-control" value="{$item['commis']}" />
                                    <span class="input-group-addon">元</span>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-xs-12 col-sm-2 col-md-2 control-label">简介</label>
                            <div class="col-sm-5">
                                <textarea style="height:200px;" class="form-control" name="content" cols="70" id="reply-add-text">{$item['content']}</textarea>
                                <span class="help-block">请输入简介</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-xs-12 col-sm-2 col-md-2 control-label">商家所在地区</label>
                            <div class="col-sm-2" style="width:13.6666%">
                                <select name="location_p" id="location_p" style="width:150px;" class="location span2 form-control"></select>
                            </div>
                            <div class="col-sm-2" style="width:13.6666%">
                                <select name="location_c" id="location_c" style="width:150px;" class="location span2 form-control"></select>
                            </div>
                            <div class="col-sm-2" style="width:13.6666%">
                                <select name="location_a" id="location_a" style="width:150px;" class="location span2 form-control"></select>
                            </div>
                            <script type="text/javascript" src="../addons/xg_jjr/style/js/region_select.js"></script>
                            <script type="text/javascript">
                                var location_p = "{if !empty($item['location_p'])}{$item['location_p']}{else}{/if}";
                                var location_c = "{if !empty($item['location_c'])}{$item['location_c']}{else}{/if}";
                                var location_a = "{if !empty($item['location_a'])}{$item['location_a']}{else}{/if}";
                                new PCAS("location_p", "location_c", "location_a", location_p, location_c, location_a);
                            </script>
                        </div>
                        <div class="form-group">
                            <label class="col-xs-12 col-sm-2 col-md-2 control-label">前台是否显示</label>
                            <div class="col-sm-5">
                                <label class="radio-inline">
                                    <input type="radio" name="isview" value="1" {if $item['isview'] == 1} checked{/if}> 显示
                                </label>
                                <label class="radio-inline">
                                    <input type="radio" name="isview" value="0" {if $item['isview'] == 0} checked{/if}>隐藏
                                </label>
                                <span class="help-block">设置前台显示后，楼盘将显示在首页</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-xs-12 col-sm-2 col-md-2 control-label">联系电话</label>
                            <div class="col-sm-5">
                                <input type="text" name="tel" class="form-control" value="{$item['tel']}" />
                                <span class="help-block">*该电话用于联系方式按钮 如不填,将不会出现预约界面</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-xs-12 col-sm-2 col-md-2 control-label">地址</label>
                            <div class="col-sm-5">
                                <input type="text" name="addr" class="form-control" value="{$item['addr']}" />
                                <span class="help-block">*该地址将用于所有地图展示处具体位置描述展现</span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-xs-12 col-sm-2 col-md-2 control-label">是否显示城市</label>
                            <div class="col-sm-5">
                                <label class="radio-inline">
                                    <input type="radio" name="iscity" value="1" {if $item['iscity'] == 1} checked{/if}> 显示
                                </label>
                                <label class="radio-inline">
                                    <input type="radio" name="iscity" value="0" {if $item['iscity'] == 0} checked{/if}>隐藏
                                </label>
                                <span class="help-block">经纪人首页城市搜索是否显示</span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-xs-12 col-sm-2 col-md-2 control-label">地图标识</label>
                            <div class="col-sm-5">
                                <input type="text" id="jw_addr" class="form-control" name="jw_addr" value="{$item['jw_addr']}" data-rule-required="true">
                                <span class="maroon" style="color: #f30;margin-left: 5px;"><br/>注意：这个只是模糊定位，准确位置请地图上标注!</span>
                                <div id="l-map" style="overflow: hidden; position: relative; z-index: 0; background-image: url(http://api.map.baidu.com/images/bg.png);width: 500px; height: 300px;margin-top: 10px; color: rgb(0, 0, 0); text-align: left;"></div>
                            </div>
                            <button class="btn" type="button" id="positioning" onclick="bmap.searchMapByAddress($('#jw_addr').val())">搜索</button>
                        </div>
                        <div class="form-group">
                            <label class="col-xs-12 col-sm-2 col-md-2 control-label">经纬度</label>
                            <div class="col-sm-2">
                                <input type="text" class="form-control" style="width:210px" id="lat" name="lat">
                            </div>
                            <div class="col-sm-2">
                                <input type="text" class="form-control" style="width:210px" id="lng" name="lng">
                            </div>
                        </div>
                    </div>
                </div>


                <div class="tab-pane" id="tab_jjr">
                    <div class="panel-body">
                        {loop $identitys $key $i}
                        <div class="form-group">
                            <label class="col-xs-12 col-sm-3 col-md-2 control-label">{if $key==0}佣金设置{/if}</label>
                            <div>

                                <div class="col-sm-5">

                                    <div class="input-group" >
                                        <input type="hidden" name="idcommissionid[]" value="{$idcommission['id'][$i['id']]}"/>
                                        <span class="input-group-addon">身份名称</span>
                                        <input type="text" name="identity_name[]" class="form-control" value="{$i['identity_name']}" readonly placeholder="" />
                                        <input type="hidden" name="identityids[]" class="form-control" value="{$i['id']}" placeholder="" />
                                        <span class="input-group-addon">佣金</span>
                                        <input type="text" name="commission[]" class="form-control" value="{$idcommission['commission'][$i['id']]}" placeholder="" />
                                    </div>

                                </div>

                            </div>
                        </div>
                        {/loop}

                        <div class="form-group">
                            <label class="col-xs-12 col-sm-2 col-md-2 control-label">内定数量</label>
                            <div class="col-sm-5">
                                <div class="input-group" >
                                    <span class="input-group-addon">推荐：</span>
                                    <input type="text" name="recnum" class="form-control" value="{$item['recnum']}" placeholder="" />
                                    <span class="input-group-addon">成交：</span>
                                    <input type="text" name="sucnum" class="form-control" value="{$item['sucnum']}" placeholder="" />
                                </div>
                            </div>
                        </div>
                        <!--<div class="form-group">-->
                            <!--<label class="col-xs-12 col-sm-2 col-md-2 control-label">是否自动分配</label>-->
                            <!--<div class="col-sm-5">-->
                                <!--<label class="radio-inline">-->
                                    <!--<input type="radio" name="isautoallot" value="1" {if $item['isautoallot'] == 1} checked{/if}> 是-->
                                <!--</label>-->
                                <!--<label class="radio-inline">-->
                                    <!--<input type="radio" name="isautoallot" value="0" {if $item['isautoallot'] == 0} checked{/if}>否-->
                                <!--</label>-->
                                <!--<span class="help-block">设置该项目是否自动分配</span>-->
                            <!--</div>-->
                        <!--</div>-->
                        <div class="form-group">
                            <label class="col-xs-12 col-sm-2 col-md-2 control-label">指定身份可见</label>
                            <div class="col-sm-7">
                                {loop $idens $i}
                                <label class="radio-inline">
                                    {$i['name']}<input type="checkbox" class="form-control" name="idviews[]" value="{$i['id']}" {if in_array($i['id'], $idviews)}checked{/if}/>
                                </label>
                                {/loop}
                                <span class="help-block">默认不选为全可见，选择后指定身份可见</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-pane" id="tab_llb">
                    <div class="panel-body">
                        <div class="form-group">
                            <label class="col-xs-12 col-sm-2 col-md-2 control-label">开盘时间：</label>
                            <div class="col-sm-5">
                                {php echo tpl_form_field_date('starttime',$item['starttime'],true)}
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-xs-12 col-sm-2 col-md-2 control-label">交房日期：</label>
                            <div class="col-sm-5">
                                {php echo tpl_form_field_date('endtime',$item['endtime'],true)}
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-xs-12 col-sm-2 col-md-2 control-label">建筑面积</label>
                            <div class="col-sm-5">
                                <input type="text" name="l_mianji" class="form-control" value="{$item['l_mianji']}" />
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-xs-12 col-sm-2 col-md-2 control-label">物业类型</label>
                            <div class="col-sm-5">
                                <input type="text" name="l_wuye" class="form-control" value="{$item['l_wuye']}" />
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-xs-12 col-sm-2 col-md-2 control-label">交房标准</label>
                            <div class="col-sm-5">
                                <input type="text" name="l_biaozhun" class="form-control" value="{$item['l_biaozhun']}" />
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-xs-12 col-sm-2 col-md-2 control-label">规划户数</label>
                            <div class="col-sm-5">
                                <input type="text" name="l_hushu" class="form-control" value="{$item['l_hushu']}" />
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-xs-12 col-sm-2 col-md-2 control-label">是否开启虚拟样板间</label>
                            <div class="col-sm-5">
                                <label class="radio-inline">
                                    <input type="radio" name="is_farme" value="1" {if $item['is_farme'] == 1} checked{/if}> 开启
                                </label>
                                <label class="radio-inline">
                                    <input type="radio" name="is_farme" value="0" {if $item['is_farme'] == 0} checked{/if}>关闭
                                </label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-xs-12 col-sm-2 col-md-2 control-label">虚拟样板间地址</label>
                            <div class="col-sm-5">
                                <input type="text" name="frame" class="form-control" value="{$item['frame']}" />
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-xs-12 col-sm-2 col-md-2 control-label">进一步了解开关</label>
                            <div class="col-sm-5">
                                <label class="radio-inline">
                                    <input type="radio" name="l_xcyh" value="1" {if $item['l_xcyh'] == 1} checked{/if}> 开启
                                </label>
                                <label class="radio-inline">
                                    <input type="radio" name="l_xcyh" value="0" {if $item['l_xcyh'] == 0} checked{/if}>关闭
                                </label>
                            </div>
                        </div>

                        <div class="form-group">

                            <label class="col-xs-12 col-sm-2 col-md-2 control-label">合作规则</label>

                            <div class="col-sm-8">

                                <textarea style="height:180px;" class="form-control" name="l_guize" id="l_guize" >{$item['l_guize']}</textarea>

                            </div>

                        </div>


                        <div class="form-group">

                            <label class="col-xs-12 col-sm-2 col-md-2 control-label">楼盘卖点</label>

                            <div class="col-sm-8">

                                <textarea style="height:180px;" class="form-control" name="l_lpmd" id="l_lpmd" >{$item['l_lpmd']}</textarea>

                            </div>

                        </div>

                        <div class="form-group">

                            <label class="col-xs-12 col-sm-2 col-md-2 control-label">目标客户</label>

                            <div class="col-sm-6">

                                <textarea style="height:180px;" class="form-control" name="l_mbkh" id="l_lpmd" >{$item['l_mbkh']}</textarea>

                            </div>

                        </div>
                    </div>
                </div>

                <div class="tab-pane" id="tab_share">
                    <div class="panel-body">
                        <div class="form-group">
                            <label class="col-xs-12 col-sm-2 col-md-2 control-label">分享标题</label>
                            <div class="col-sm-5">
                                <input type="text" name="sh_title" class="form-control" value="{$item['sh_title']}" />
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-xs-12 col-sm-2 col-md-2 control-label">分享内容</label>
                            <div class="col-sm-5">
                                <input type="text" name="sh_cont" class="form-control" value="{$item['sh_cont']}" />
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-xs-12 col-sm-2 col-md-2 control-label">分享图标</label>
                            <div class="col-sm-5">
                                {php echo tpl_form_field_image('icon', $item['icon']);}
                                <span class="help-block">请上传分享时的图标，大小为100*100</span>
                            </div>
                        </div>
                    </div>
                </div>

            </div>


        </div>

    </div>
    <div class="panel-body" style="">

        <input type="hidden" name="token" value="{$_W['token']}" />
        <input type="submit" value="保存项目" class="btn btn-primary" />
    </div>

</form>


<script type="text/javascript" src="http://api.map.baidu.com/api?v=1.4"></script>
<script type="text/javascript" src="http://api.map.baidu.com/getscript?v=1.4&ak=&services=&t=20140102035142"></script>
<script type="text/javascript">
    require(['jquery', 'util'], function ($, u) {

        $(function () {

            u.editor($('#l_guize')[0]);
            u.editor($('#l_lpmd')[0]);

        });

    });
    $(function () {
        $('#myTab a').click(function (e) {
            e.preventDefault();
            $(this).tab('show');
        });
        $(".location").change(function () {
            bmap.searchMapByPCD();
        });
    });
    new PCAS("location_p", "location_c", "location_a", location_p, location_c, location_a);
    var bmap = {
        'option': {
            'lock': false,
            'container': 'l-map',
            'infoWindow': {'width': 250, 'height': 100, 'title': ''},
            'point': {'lng': "{if $item['lng']!='0.0000000000' && !empty($item['lng'])}{$item['lng']}{else}118.134535{/if}", 'lat': "{if $item['lat']!='0.0000000000' && !empty($item['lat'])}{$item['lat']}{else}24.468728{/if}"}
        },
        'init': function (option) {
            var $this = this;
            $this.option = $.extend({}, $this.option, option);

            $this.option.defaultPoint = new BMap.Point($this.option.point.lng, $this.option.point.lat);
            $this.bgeo = new BMap.Geocoder();
            $this.bmap = new BMap.Map($this.option.container);
            $this.bmap.centerAndZoom($this.option.defaultPoint, 15);
            $this.bmap.enableScrollWheelZoom();
            $this.bmap.enableDragging();
            $this.bmap.enableContinuousZoom();
            $this.bmap.addControl(new BMap.NavigationControl());
            $this.bmap.addControl(new BMap.OverviewMapControl());
            //添加标注
            $this.marker = new BMap.Marker($this.option.defaultPoint);
            $this.marker.setLabel(new BMap.Label('请您移动此标记，选择您的坐标！', {'offset': new BMap.Size(10, -20)}));
            $this.marker.enableDragging();
            $this.bmap.addOverlay($this.marker);
            //$this.marker.setAnimation(BMAP_ANIMATION_BOUNCE);
            $this.showPointValue($this.marker.getPosition());
            //拖动地图事件
            $this.bmap.addEventListener("dragging", function () {
                $this.setMarkerCenter();
                $this.option.lock = false;
            });
            //缩入地图事件
            $this.bmap.addEventListener("zoomend", function () {
                $this.setMarkerCenter();
                $this.option.lock = false;
            });
            //拖动标记事件
            $this.marker.addEventListener("dragend", function (e) {
                $this.showPointValue();
                $this.showAddress();
                $this.bmap.panTo(new BMap.Point(e.point.lng, e.point.lat));
                $this.option.lock = false;
                $this.marker.setAnimation(null);
            });
        },
        'searchMapByAddress': function (address) {
            var $this = this;
            $this.bgeo.getPoint(address, function (point) {
                if (point) {
                    $this.showPointValue();
                    $this.showAddress();
                    $this.bmap.panTo(point);
                    $this.setMarkerCenter();
                }
            });
        },
        'searchMapByPCD': function (address) {
            //alert($('#location_p').val()+$('#location_c').val()+$('#location_a').val());
            var $this = this;
            $this.option.lock = true;
            $this.searchMapByAddress($('#location_p').val() + $('#location_c').val() + $('#location_a').val());
        },
        'setMarkerCenter': function () {
            var $this = this;
            var center = $this.bmap.getCenter();
            $this.marker.setPosition(new BMap.Point(center.lng, center.lat));
            $this.showPointValue();
            $this.showAddress();
        },
        'showPointValue': function () {
            var $this = this;
            var point = $this.marker.getPosition();
            $('#lng').val(point.lng);
            $('#lat').val(point.lat);
        },
        'showAddress': function () {
            var $this = this;
            var point = $this.marker.getPosition();
            $this.bgeo.getLocation(point, function (s) {
                if (s) {
                    $('#jw_addr').val(s.address);
                    if (!$this.option.lock) {
                        //cascdeInit(s.addressComponents.province,s.addressComponents.city,s.addressComponents.district);
                        new PCAS("location_p", "location_c", "location_a", s.addressComponents.province, s.addressComponents.city, s.addressComponents.district);
                    }
                }
            });
        }
    };
    $(function () {
        var option = {};
        bmap.init(option);
    });</script>

{template '_footer'}